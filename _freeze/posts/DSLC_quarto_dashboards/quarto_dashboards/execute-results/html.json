{
  "hash": "57c12396079b461983341ab00e746d62",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Interactive Quarto Dashboards\"\nauthor: \"Derek Sollberger\"\ndate: \"2025-02-26\"\nformat:\n  html\n---\n\n\n\n# Interactive Dashboards\n\nIn this workshop, we will explore the relatively new technology called [Quarto dashboards](https://quarto.org/docs/dashboards/). In this exploration, I have chosen a different data set per my interest, but much of the credit for the design of this workshop goes to the folks at Posit and other data scientists who have already created wonderful tutorials (see Additional Resources). Furthermore, we will incorporate interactive elements into our dashboards using `shiny`.  I will introduce the materials and invite you to try out some of the steps on your own (here: in Zoom breakout rooms)\n\n## About the Presenter\n\nDerek Sollberger is a lecturer with CSML (Center for Statistics and Machine Learning) where he teaches Data Science and Bayesian Analysis. He has led several R programming workshops with ESL (Engineering Service Learning) and is a Posit Certified Tidyverse Instructor. Here he brings experience from acting as a data analysis consultant for several research projects in pedagogy.\n\n## Dashboards\n\nIt may be a good idea to get a sense of what we mean by \"dashboards\".  Let us spend a few minutes looking at a couple of examples from the Posit websites.\n\n* [Examples](https://quarto.org/docs/dashboards/#examples) from Posit\n\n## Libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"bslib\")\nlibrary(\"bsicons\")\nlibrary(\"sf\")\nlibrary(\"tidyverse\")\n\nbee_data <- readr::read_csv(\"bee_data.csv\")\nstates_shp <- readr::read_rds(\"us_states_shp.rds\")\n\ncolor_1 <- \"#E77500\"\ncolor_2 <- \"#121212\"\n```\n:::\n\n\n\n## Posit Cloud\n\nFor our convenience here in this workshop, you will be directed to [fork] a workspace in Posit Cloud.  That is, we have supplied the data sets, image files, and code libraries in advance.\n\n# Case Study: Bees!\n\n## Concern for Bee Populations\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![Time](bee_news_1.png)\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![ABC](bee_news_2.png)\n:::\n\n::::\n\n## Data Source\n\nOur data come from the Quick Stats at [USDA NASS](https://www.nass.usda.gov/) (United States Department of Agriculture National Agricultural Statistics Service).  Users can access a subset of the data through dropdown menus.  For replicability, I list my selections below:\n\n![USDA NASS Quick Stats](bee_search_criteria.png)\n\n* **Commodity:**\n\n    * **Program:** SURVEY\n    * **Sector:** ANIMALS & PRODUCTS\n    * **Group:** SPECIALTY\n    * **Commodity:** HONEY\n    * **Category:** INVENTORY\n    * **Data item:** HONEY, BEE COLONIES - INVENTORY, MEASURED IN COLONIES\n    \n* **Location:**\n\n    * **Geographic Level:** STATE\n    * **State:** [leave unselected for all states]\n    \n* **Time:**\n\n    * **Year:** [selected 2014 to 2024 to obtain about a decade of data]\n    * **Period Type:** ANNUAL (note: the \"annual\" measurements were done by each state, while other granularity might not be available for all states)\n    * **Period:** MARKETING YEAR\n\n## Bar Charts\n\n:::: {.panel-tabset}\n\n## Plot\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](quarto_dashboards_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbee_data |> \n  group_by(Year) |>\n  mutate(total_colonies = sum(Value)) |>\n  ungroup() |>\n  select(Year, total_colonies) |>\n  distinct() |>\n  mutate(num_colonies = total_colonies / 1e6) |>\n  ggplot(aes(x = factor(Year), y = num_colonies)) +\n  geom_bar(color = \"#121212\", fill = \"#E77500\",\n           stat = \"identity\") +\n  coord_cartesian(ylim = c(2.5,3.0)) +\n  labs(title = \"US Bee Population\",\n       subtitle = \"Survey of bee colonies\",\n       # caption = \"source: USDA NASS\",\n       x = \"year\",\n       y = \"bee colonies (in millions)\") +\n  theme_minimal()\n```\n:::\n\n\n\n## Each State\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](quarto_dashboards_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnj_plot <- bee_data |> \n  filter(State == \"NEW JERSEY\") |>\n  mutate(num_colonies = Value / 1e3) |>\n  ggplot(aes(x = factor(Year), y = num_colonies)) +\n  geom_bar(color = \"#121212\", fill = \"#E77500\",\n           stat = \"identity\") +\n  labs(title = \"NEW JERSEY\",\n       subtitle = \"Survey of bee colonies\",\n       caption = \"source: USDA NASS\",\n       x = \"year\",\n       y = \"bee colonies (in thousands)\") +\n  theme_minimal()\n\nnj_plot\n```\n:::\n\n\n\n## Facets\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](quarto_dashboards_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbee_data |>\n  filter(Year >= 2015 & Year <= 2019) |>\n  filter(State %in% c(\"CALIFORNIA\", \"NEW JERSEY\")) |>\n  ggplot(aes(x = Year, y = Value)) +\n  facet_wrap(vars(State), scales = \"free_y\") +\n  geom_bar(color = \"#121212\", fill = \"#E77500\", stat = \"identity\")\n```\n:::\n\n\n\n::::\n\n## Maps\n\n:::: {.panel-tabset}\n\n## Spatial Viz\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](quarto_dashboards_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_shp |>\n  mutate(this_selection = ifelse(NAME == \"New Jersey\", \n                               \"focus\", \"other states\")) |>\n  ggplot() +\n  geom_sf(aes(fill = this_selection)) +\n  labs(title = \"State Selection\", \n         subtitle = \"toward a Dashboard card\",\n         caption = \"Princeton Wintersession\") +\n  scale_fill_manual(values = c(color_1, \"gray80\")) +\n  theme_minimal()\n```\n:::\n\n\n\n## Each State\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](quarto_dashboards_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnj_map <- states_shp |>\n  mutate(this_selection = ifelse(NAME == \"New Jersey\", \n                               \"focus\", \"other states\")) |>\n  ggplot() +\n  geom_sf(aes(fill = this_selection)) +\n  labs(title = \"New Jersey\", \n         # subtitle = \"toward a Dashboard card\",\n         caption = \"Princeton Wintersession\") +\n  scale_fill_manual(values = c(color_1, \"gray80\")) +\n  theme_minimal() +\n  theme(axis.title.x = element_blank(),\n        axis.text.x  = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.y  = element_blank(),\n        axis.ticks.y = element_blank(),\n        legend.position = \"none\")\n\nnj_map\n```\n:::\n\n\n\n::::\n\n\n\n# Setup (YAML and QMD)\n\nIn a Posit Cloud session, create a new Quarto document, and then change the `format` to `dashboard`.\n\n```\n---\ntitle: \"My Dashboard\"\nformat: dashboard\n---\n\n# notebook content goes here...\n```\n\n\n## Cards\n\nEach additional visible object is arranged into the dashboard as a *card*.\n\n## Layout\n\n### Rows\n\nBy default, the arrangement of the cards is in rows.\n\n### Columns\n\nThe default settings use \n\n* first-level headers (`#`) for tabs\n* second-level headers (`##`) for rows\n* third-level headers (`###`) for columns\n\n::: {.callout-tip collapse=\"true\"}\n## Orientation\n\nTo change the arrangements into columns, change the YAML header\n\n```\nformat: \n  dashboard:\n    orientation: columns\n```\n\nMore specifically, our file will use \n\n* first-level headers (`#`) for tabs\n* second-level headers (`##`) for columns\n* third-level headers (`###`) for rows\n\n:::\n\n## Activity 1\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n* Create a new Quarto document whose YAML \n\n    * creates a `dashboard`  \n    * includes `orientation: columns`\n    \n* Form a layout with\n\n    * 2 columns\n    * 2 rows in the first column, 3 rows in the second column\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"40%\"}\n![Activity 1](activity_1_diagram.png)\n:::\n\n::::\n\n\n\n\n# Prototype Content\n\nLet us now place some content into the cards (as placeholders) to see how our plans are faring.  We will be starting from `template_1.qmd`.\n\n## Plots\n\nAs usual in R, we can have code chunks that display plots. Observe that we have loaded some objects into the environment such as `bee_data`.\n\nFor starters, we can put a code chunk into the first card (column 1, row 1) that displays the `nj_plot`.\n\n\n\n\n```{.r .cell-code}\nnj_plot\n```\n\n\n\nEach card used this way can be given a **title**.  We can add a title to a card using the `#| title: ` code chunk in Quarto markdown.\n\n## Value Boxes\n\nTo emphasize certain words or numbers in the dashboard, we can use `valueboxes`.  For example, let us place a valuebox into the top-right card (column 2, row 1) that simply says a state name for now.\n\n\n```\n::: {.valuebox icon=\"award-fill\" color=\"#E77500\"}\nNEW JERSEY\n:::\n```\n\nOf importance, for a valuebox to appear and function as intended, the `R` code needs to output a value.\n\n## Activity 2\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n* Starting from `template_1.qmd`\n* Place `nj_map` into the bottom-left card (column 1, row 2)\n\n    * give this card a title\n    \n* Create two more valueboxes\n\n    * feel free to use different icons and colors\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"40%\"}\n![Activity 2](activity_2_diagram.png)\n:::\n\n::::\n\n\n# Interactive Content\n\nNow we aim to offer interactivity to the user.\n\n## Shiny\n\n![Shiny app](shiny_1.png)\n\n* image source: [Introduction to Data Science](https://bookdown.org/hneth/i2ds/shiny.html#shiny-overview)\n\n![Shiny code](shiny_2.png)\n\n* image source: [Ted Laderas](https://laderast.github.io/gradual_shiny/app-1-connecting-ui-and-server.html)\n\n## Shiny Dashboard\n\nSome code elements that are paramount here include needing\n\n* `server: shiny` in the YAML\n* `context: setup` in the first code block (i.e. where you load code libraries)\n* `context: server` in the main code block\n\n## Sidebar\n\nContinuing our thoughts about the app layout, and how we want an intuitive place for our user-interface objects, let us put in a **sidebar**\n\n```\n## {.sidebar}\n\nInstructions to user goes here\n```\n### Inputs\n\nLet the user pick the state. Place the following code into the sidebar.\n\n```\nselectInput(\n  \"state_choice\",\n  \"Choose a state:\",\n  choices = unique(bee_data$State)\n)\n```\n\nLet the user pick the year.  Place the following code into the sidebar.\n\n```\nsliderInput(\n  \"year_choice\", \"Choose a year:\",\n  min = 2015, max = 2023, step = 1, \n  value = 2023,\n)\n```\n\n## Server\n\nNow, we need use the `shiny` framework to perform these computations in a *reactive* way.  Create the following code chunk, and be sure to set `#| context: server`.\n\n```\n#| context: server\noutput$state_plot <- renderPlot({\n  bee_data |> \n  filter(State == input$state_choice) |>\n  mutate(num_colonies = Value / 1e3) |>\n  mutate(year_color = ifelse(Year == input$year_choice,\n         TRUE, FALSE)) |>\n  ggplot(aes(x = factor(Year), y = num_colonies)) +\n  geom_bar(aes(fill = year_color),\n           color = \"#121212\", ,\n           stat = \"identity\") +\n  labs(title = paste0(str_to_title(input$state_choice)),\n       subtitle = \"Survey of bee colonies\",\n       caption = \"source: USDA NASS\",\n       x = \"year\",\n       y = \"bee colonies (in thousands)\") +\n  scale_fill_manual(values = c(\"#121212\", \"#E77500\")) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n})\n\n\noutput$state_choice <- renderText({input$state_choice})\n\n```\n\n## Plots\n\nNow we have have the `output` in place, we can use more `shiny` code to plot that output. Where the barchart code was intended to be, place the following\n\n```\nplotOutput(\"state_plot\")\n```\n\n## Valueboxes\n\nNow we have have the `output` in place, we can use more `shiny` code to display  certain numbers. Inside the valueboxes' divs, place the following\n\n```\nr textOutput(\"state_choice\")\n```\n\n## Activity 3\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nStarting from `template_2.qmd`\n\n* `server`: use `renderPlot` on the code that produces a map from the shapefile\n* `server`: use `renderText` on the `slider_input` variable to place `year_choice` in the `output`\n* `ui`: use `textOutput` to display the user's `year_choice`.\n* `ui`: use `plotOutput` to show the map (of the contiguous United States)\n\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"40%\"}\n![Activity 3](activity_3_diagram.png)\n:::\n\n::::\n\n\n# Data Mining\n\nFortunately, for this relatively simple app, the usual `dplyr` verbs work well with our data.  Just remember when to call variables from the `input` selections. For example, when the user makes their choice among the states, the result is stored in `input$state_choice`, and we can use it in `filter`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbee_data |> \n  filter(State == input$state_choice)\n```\n:::\n\n\n\n## Activity 4\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\nStarting from `template_3.qmd`, try to implement the following in your interactive Quarto dashboard:\n\n* allow the user's `year_choice` to affect which bar is highlighted in the bar graph\n* allow the user's `year_choice` to affect which state is highlighted in the state map\n* correctly restate the number of bee colonies for the user's selections of state and year.\n* rename the document from \"Activity 4\" to \"Bee Dashboard\"\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"40%\"}\n![Activity 4](activity_4_diagram.png)\n:::\n\n::::\n\n# Epilogue\n\n**Congratulations** on making your interactive Quarto dashboard.\n\nIf you have comments---especially on how to expand this workshop---please let me know!\n\n## Additional Resources\n\nFor this workshop, I followed the materials presented by Mine Cetinkaya-Rundel and Posit\n\n* [Part 1](https://www.youtube.com/watch?v=HW7QbqI4fH0), [Part 2](https://www.youtube.com/watch?v=KdsQgwaY950), [Part 3](https://www.youtube.com/watch?v=NigWSB-jG4Y)\n\nFolks that are interested in learning more about Quarto Dashboards can refer to resources such as the following:\n\n* How to [Automate](https://www.youtube.com/watch?v=xnJuXOw7iu8) your Reporting by Isabella Velasquez\n* [Easy Dashboards](https://www.youtube.com/watch?v=R3sNVE8TYeo) by The GRAPH Courses\n* Interactive Infographic using [DisplayR](https://www.youtube.com/watch?v=RXdcHCPJRg8) by Melisaa Van Bussel\n* [Quarto Dashboards](https://www.youtube.com/watch?v=jX4_Dnzhl0M) by Charles Teague\n* [Quarto Dashboards](https://www.youtube.com/watch?v=Kq1hgg2NtE4) by Isabella Velasquez\n* How to [Style](https://www.youtube.com/watch?v=jX4_Dnzhl0M) your Quarto docs without HTML & CSS by Albert Rapp\n\n* [Beyond Dashboards](https://www.youtube.com/watch?v=fzykFa6c3LI) by Sean Nguyen\n\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n\n:::\n\n::::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "quarto_dashboards_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}