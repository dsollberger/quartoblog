{
  "hash": "d092ba8ac27b17940db13b0e5169e996",
  "result": {
    "markdown": "---\ntitle: \"Canvas_Roster\"\nauthor: \"Derek Sollberger\"\ndate: \"2023-01-11\"\nformat: html\n---\n\n\nWith the goal of learning my students' names faster, I wrote an R script that will convert a roster (\"People\" in a Canvas course) to a `gt` table for later offline use.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(eval = FALSE)\n```\n:::\n\n\n\n# Setup\n\nIn your Canvas course, go to `People`, right-click on the roster, and click \"Save Page As\"\n\n* be sure to save the \"complete\" web page (this creates a folder with all of the students' pictures)\n* place the also downloaded HTML file into the folder\n* place this code script into the folder\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# change this file name as needed\nHTML_file_name <- \"Course Roster S23-BIO 018 01.htm\"\n\nlibrary(\"gt\")\nlibrary(\"gtExtras\")\nlibrary(\"rvest\")\nlibrary(\"tidyverse\")\n```\n:::\n\n\n# Roster table\n\nhttps://www.r-bloggers.com/2020/04/scrape-html-table-using-rvest/\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontent <- read_html(HTML_file_name)\ntables <- content |> html_table(fill = TRUE)\nroster_table <- tables[[1]]\n\nroster_df <- roster_table |>\n  select(Name, Section) |>\n  mutate(discussion_tag = str_extract(Section, \"Discussion-\\\\d\\\\dD\")) |>\n  separate(discussion_tag, sep = \"-\", into = c(\"disregard\", \"discussion_section\")) |>\n  select(Name, discussion_section) |>\n  \n  # remove instructor of record\n  filter(!is.na(discussion_section))\n```\n:::\n\n\n# Images\n\nhttps://community.rstudio.com/t/scraping-images-from-the-web/133239\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_urls <- content |> html_elements(\"img\")\nnum_images <- length(image_urls)\n\nimage_df_raw <- data.frame(html_raw = rep(NA, num_images))\nfor(img in 1:num_images){\n  image_df_raw$html_raw[img] <- as.character(image_urls[[img]])\n}\n\nimage_df <- image_df_raw |>\n  \n  # skip first two images?\n  slice(3:n()) |>\n  \n  # roundabout because some people's names have more than 2 words\n  separate(col = \"html_raw\", sep = \"alt=\", \n           into = c(\"part1\", \"part2\")) |>\n  \n  separate(col = \"part1\", sep = \" \", into = c(\"tag1\", \"src\")) |>\n  separate(col = \"src\", sep = \"/\", into = c(\"stem\", \"profile_picture\")) |>\n  separate(col = \"part2\", sep = \" aria\", into = c(\"student_name\", \"tag2\")) |>\n  \n  select(profile_picture, student_name)\n\n# remove quotation marks\nimage_df$profile_picture <- str_replace_all(image_df$profile_picture, \"\\\"\", \"\")\nimage_df$student_name <- str_replace_all(image_df$student_name, \"\\\"\", \"\")\n```\n:::\n\n\n# Merge\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroster_df <- roster_df |>\n  left_join(image_df, by = c(\"Name\" = \"student_name\")) |>\n  select(profile_picture, Name, discussion_section)\n```\n:::\n\n\n# gt\n\nhttps://jthomasmock.github.io/gtExtras/reference/gt_img_rows.html\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroster_gt <- roster_df |>\n  gt() |>\n  gt_img_rows(columns = profile_picture, img_source = \"local\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngtsave(roster_gt, \"roster.png\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}