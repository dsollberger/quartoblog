{
  "hash": "8a0e944e2a94675c328bcf46fd84a990",
  "result": {
    "markdown": "---\ntitle: \"Coefficient of Variation\"\nauthor: \"Derek Sollberger\"\ndate: \"2022-09-02\"\nformat: \n  html:\n    toc: true\n---\n\n\nFor a future lecture in my *Sports Analytics* course, I want an example of a baseball statistic where the averages for two players are similar, but their variances in that same statistic are quite different.  It is still early in the semester, so I am looking for an easy-to-understand statistic.  Therefore, I will explore home runs per season.\n\n## A Walk Through the Data\n\nThe `Lahman` database contains a lot of baseball statistics, and today I will focus on the `Batting` data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"Lahman\")\nlibrary(\"tidyverse\")\n```\n:::\n\n\nFor interest, I will `filter` the observations to retain the players from the past 18 seasons (since my students are about 18 years old, haha) and  player-seasons that included at least 100 at-bats.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- Batting |>\n  filter(yearID >= (2021 - 18)) |>\n  filter(AB >= 100)\n```\n:::\n\n\nTo be illustrative, permit me to `select` mainly the seasons and home run columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df |>\n  select(playerID, yearID, AB, HR)\n```\n:::\n\n\nAt the moment, here is what our data looks like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   playerID yearID  AB HR\n1 abreubo01   2003 577 20\n2 alfoned01   2003 514 13\n3 almoner01   2003 100  1\n4 alomaro01   2003 263  2\n5 alomaro01   2003 253  3\n6 alomasa02   2003 194  5\n```\n:::\n:::\n\n\nSince I am concerned with season averages, I am going to `group_by` the player name.  From there, let us then compute the averages and standard deviations for home runs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df |>\n  group_by(playerID) |>\n  mutate(xbar = mean(HR, na.rm = TRUE),\n         s    = sd(HR, na.rm = TRUE)) |>\n  ungroup()\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 6\n  playerID  yearID    AB    HR  xbar      s\n  <chr>      <int> <int> <int> <dbl>  <dbl>\n1 abreubo01   2003   577    20 14.3   8.94 \n2 alfoned01   2003   514    13  8.67  5.86 \n3 almoner01   2003   100     1  1    NA    \n4 alomaro01   2003   263     2  2.67  0.577\n5 alomaro01   2003   253     3  2.67  0.577\n6 alomasa02   2003   194     5  2.33  2.52 \n```\n:::\n:::\n\n\nFor various reasons, some players only appear once in this subset of data, so their variance is effectively zero (missing in the computation).  To answer my original inquiry mathematically, I will now compute the **coefficient of variation** (and avoid a divide-by-zero error from those players who hit zero home runs).\n\n\n$$CoV = \\frac{s}{\\bar{x}}$$\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df |>\n  # filter(!is.na(s)) |>\n  filter(xbar > 0) |>\n  mutate(CoV = s/xbar) |>\n  arrange(desc(CoV))\n```\n:::\n\n\nIn this metric, the top scores are\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  playerID  yearID    AB    HR  xbar     s   CoV\n  <chr>      <int> <int> <int> <dbl> <dbl> <dbl>\n1 gathrjo01   2005   203     0  0.2  0.447  2.24\n2 gathrjo01   2006   154     0  0.2  0.447  2.24\n3 gathrjo01   2006   229     1  0.2  0.447  2.24\n4 gathrjo01   2007   228     0  0.2  0.447  2.24\n5 gathrjo01   2008   279     0  0.2  0.447  2.24\n6 burriem01   2008   240     1  0.25 0.5    2   \n```\n:::\n:::\n\n\nand the bottom scores are\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntail(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  playerID  yearID    AB    HR  xbar     s   CoV\n  <chr>      <int> <int> <int> <dbl> <dbl> <dbl>\n1 wadela01    2021   336    18    18    NA    NA\n2 wallsta01   2021   152     1     1    NA    NA\n3 walshja01   2021   530    29    29    NA    NA\n4 whiteel04   2021   198     6     6    NA    NA\n5 williju02   2021   119     4     4    NA    NA\n6 wisdopa01   2021   338    28    28    NA    NA\n```\n:::\n:::\n\n\n## Heavy Hitters\n\nSo far, these results seem to be fine mathematically, but they might be uninteresting to the casual baseball fan.  To further prune down to recognizable players, let me further filter the data down to players with at least 5 of these 100+ at-bat seasons in the past 18 seasons---and had an average of over 10 home runs per season.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df |>\n  group_by(playerID) |>\n  mutate(seasons = n()) |>\n  ungroup() |>\n  filter(seasons >= 5) |>\n  filter(xbar >= 5) |>\n  arrange(desc(CoV))\n```\n:::\n\n\nNow, the top scores in using the coefficient of variation as my metric are\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  playerID  yearID    AB    HR  xbar     s   CoV seasons\n  <chr>      <int> <int> <int> <dbl> <dbl> <dbl>   <int>\n1 santada01   2014   405     7   7.5  10.3  1.38       6\n2 santada01   2015   261     0   7.5  10.3  1.38       6\n3 santada01   2016   233     2   7.5  10.3  1.38       6\n4 santada01   2017   143     3   7.5  10.3  1.38       6\n5 santada01   2019   474    28   7.5  10.3  1.38       6\n6 santada01   2021   116     5   7.5  10.3  1.38       6\n```\n:::\n:::\n\n\nand the lowest $Cov$ are\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntail(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  playerID  yearID    AB    HR  xbar     s   CoV seasons\n  <chr>      <int> <int> <int> <dbl> <dbl> <dbl>   <int>\n1 delgaca01   2003   570    42  34.5  6.32 0.183       6\n2 delgaca01   2004   458    32  34.5  6.32 0.183       6\n3 delgaca01   2005   521    33  34.5  6.32 0.183       6\n4 delgaca01   2006   524    38  34.5  6.32 0.183       6\n5 delgaca01   2007   538    24  34.5  6.32 0.183       6\n6 delgaca01   2008   598    38  34.5  6.32 0.183       6\n```\n:::\n:::\n\n\nWell, I do recognize more of the player names, but I realize that the $Cov$ alone does not completely solve my question since I still wanted similar averages between two players.\n\n## A Metric on top of a Metric\n\nNow, hear me out.  If there are two players $A$ and $B$, then what I am looking for is a rate of change of the form\n\n\n$$Y = \\frac{\\text{CoV}_{A} - \\text{CoV}_{B}}{\\bar{x}_{A} - \\bar{x}_{B}}$$",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}